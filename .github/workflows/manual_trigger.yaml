name: Manual Trigger

on:
  workflow_dispatch:

env:
  POTATO: 'this is a env POTATO'
  GIT_BRANCH_SELECTED: ${{ github.ref_name }}

jobs:
  verify_custom_branch_allowed:

    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          ref: ${{ env.GIT_BRANCH_SELECTED }}

      - name: Verify branch name
        run: |
          BLOCKED_BRANCHES="dev stage"
          for blocked in $BLOCKED_BRANCHES; do
            if [[ "${GIT_BRANCH_SELECTED}" == "$blocked" ]]; then
              echo "This workflow can't be run on the '$blocked' branch."
              exit 1
            fi
          done

      - name: Show workflow file branch 1
        run: |
          echo "Workflow file branch ref: ${{ github.ref }}"
          echo "Workflow file branch name: ${{ github.ref_name }}"
          echo "This is the env of gitname ${{ env.GIT_BRANCH }}"

      - name: Definir nova branch
        run: |
          echo "GIT_BRANCH_SELECTED=meu-novo-valor" >> $GITHUB_ENV

      - name: Show workflow file branch 2
        run: |
          echo "Workflow file branch ref: ${{ github.ref }}"
          echo "Workflow file branch name: ${{ github.ref_name }}"
          echo "This is the env of gitname ${{ env.GIT_BRANCH }}"


  run-manually:
    needs: verify_custom_branch_allowed
    runs-on: ubuntu-latest
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
        with:
          ref: ${{ github.ref }}

      - name: Show workflow file branch
        run: |
          echo "Workflow file branch ref: ${{ github.ref }}"
          echo "Workflow file branch name: ${{ github.ref_name }}"
          echo "This is the env of gitname ${{ env.GIT_BRANCH }}"

